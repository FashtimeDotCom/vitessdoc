# 什么是vitess
  Vitess是用于扩展MySQL的数据库解决方案, 他可以有效的运行在基于专用硬件设备的公有云或者私有云上;  
通过NoSQL数据库的可扩展性它结合并扩展了许多重要的MySQL功能。自2011年起，Vitess一直为所有YouTube数据库流量提供服务。


# Kubernetes上运行vitess
  Kubernetes是一个开源的容器管理系统，Vitess可以作为Kubernetes可感知的云本地分布式数据库运行。  
  Kubernetes处理集群中的节点调度计划，管理节点上的工作负载，方便管理构成应用的容器组。他提供了一个类似于Vitess在YouTube运行的
开源环境。  

# 参数对比
  以下部分将Vitess与两个常见的替代方案（普通MySQL和NoSQL）进行比较。

## Vitess和普通MySQL
   Vitess在以下几个方面对普通的MySQL进行改进:

普通Mysql|Vitess
:------|:----
每个MySQL连接的内存开销在256KB到近3MB之间，具体的取决于你使用的MySQL版本;随着用户数量的增长，必须要添加RAM以支持其他连接，但是增加RAM并不能带来查询速度的提高。另外，获取更多连接的同时会增加CPU的成本。                  |Vitess基于gRPC协议创建的都是轻量级的连接，Vitess连接池功能使用Go的并发支持将这些轻量级连接映射到一个小型的MySQL连接池;因此，Vitess可以轻松处理数千个连接。
写的不好的查询（例如：sql中没有增加limit）会给数据库的所有用户带来负面的影响|Vitess采用SQL解析器，它使用一组可配置的规则来重写可能损害数据库性能的查询。
分片是对数据进行分区以提高可伸缩性和性能的过程。MySQL缺少本机分片支持，需要在应用程序中编写分片代码和嵌入分片逻辑|Vitess使用基于范围的分片；它支持水平和垂直重新分区，只需几秒钟的只读停机即可完成大多数数据转换。Vitess甚至可以适应您已有的自定义分片计划。
基于复制协议的MySQL集群包含一个主库和多个从库， 如果主库宕机，其中一个从库会被提升为主库继续提供服务； 这就需要管理数据库的生命周期同时告知应用当前系统的状态。|Vitess有助于管理数据库方案的生命周期。它支持并自动处理各种场景，包括主故障转移和数据备份。
MySQL集群可以具有针对不同工作负载的自定义数据库配置，例如用于写入的主库、为web客户端提供的快速只读从库、为批处理作业提供的较慢的只读副本等等。如果数据库具有水平分片，则需要为每个分片重复设置，应用程序需要编写逻辑来确认如何找到正确的数据库。|Vitess使用支持数据一致性的存储系统来存储拓扑结构，例如etcd或ZooKeeper。这意味着集群视图始终是最新的，并且对于不同的客户端都是一致的；Vitess还提供了一个代理，可以将查询有效地路由到最合适的MySQL实例。

## Vitess和NoSQL
  如果你考虑一个NoSQL解决方案主要是出于对MySQL的可扩展性的担忧，那么Vitess可能是您的应用程序最佳的选择。虽然NoSQL为非结构化数据提供了极大的支持，但Vitess仍然提供了NoSQL数据存储中不可用的几个优点：

NoSQL|Vitess
:------|:----
NoSQL数据库不定义数据库表之间的关系，并且只支持SQL语言的一个子集。|Vitess不是一个简单的键值存储,它支持复杂的查询语义，如where子句，JOINS，聚合函数等。
NoSQL数据存储不支持事务。|Vitess支持单分片中的事务。我们还在探索使用2PC支持跨分片事务的可行性。
NoSQL解决方案具有定制API，从而导致定制架构，应用程序和工具。|Vitess对MySQL增加很少的变动(一个大多数人已经习惯于使用的数据库)。
与MySQL相比，NoSQL解决方案对数据库索引提供有限的支持。|Vitess允许您使用所有MySQL的索引功能来优化查询性能。

# 特征
* 性能
  * 连接池 - 扩展前端连接，同时优化MySQL性能
  * 查询去重 - 对于正在运行的查询在执行期间接收的任何相同请求都会复用查询结果
  * 事务管理 - 限制并发事务的数量并管理截止时间以优化整体吞吐量
* 保护
  * 查询重写和预防 - 添加限制并避免任何非确定性更新
  * 查询黑名单 - 自定义规则防止可能有问题的查询命中数据库
  * 查询终止 - 终止需要太长的时间才能返回数据的查询
  * 表访问控制 - 指定连接用户对表的访问控制列表
* 监控
  * 性能分析 - 工具允许您监视，诊断和分析数据库性能
  * 流式查询 - 使用传入查询列表来提供OLAP工作负载
  * 流式更新 - A server streams the list of rows changing in the database, which can be used as a mechanism to propagate changes to other data stores.
* 拓扑管理工具
  * 主库管理工具(处理主切换)
  * 基于Web GUI管理工具
  * 设计用于在多个数据中心/地区提供服务
* 分片
  * 几乎无缝的动态重新分片
  * 垂直和水平分片支持
  * 内置基于范围的分片方式和应用程序自定义的分片方式的支持。

# 结构
